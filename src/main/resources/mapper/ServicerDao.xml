<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--类名-->
<mapper namespace="com.house.dao.ServicerDao">

    <resultMap type="com.house.entity.Servicer" id="servicermap">
        <id column="servicer_id" property="servicerid"/>
        <result column="servicer_name" property="servicername"/>
        <result column="servicer_age" property="servicerage"/>
        <result column="servicer_sex" property="servicersex"/>
        <result column="servicer_phone" property="servicerphone"/>
        <result column="servicer_img" property="servicerimg"/>
        <result column="servicer_experience" property="servicerexperience"/>
        <result column="servicer_score" property="servicerscore"/>
        <result column="servicer_price" property="servicerprice"/>
        <result column="servicer_des" property="servicerdes"/>
        <result column="servicer_file" property="servicerfile"/>
        <result column="create_time" property="createtime"/>
        <result column="lastedit_time" property="lastedittime"/>
        <result column="enable_status" property="enablestatus"/>
        <result column="check_status" property="checkstatus"/>
        <association property="degree" column="degree_id" javaType="com.house.entity.Degree">
            <id column="degree_id" property="degreeid"/>
            <result column="degree_name" property="degreename"/>
            <result column="dpriority" property="priority"/>
        </association>
        <association property="servicetype" column="servicetype_id" javaType="com.house.entity.ServiceType">
            <id column="servicetype_id" property="servicetypeid"/>
            <result column="servicetype_name" property="servicetypename"/>
            <result column="stpriority" property="priority"/>
        </association>
        <!--相同类型属性通过命名区分查询-->
        <association property="city" column="city_id" javaType="com.house.entity.WorkArea">
            <id column="city_id" property="workareaid"/>
            <result column="city_name" property="workareaname"/>
            <result column="cpriority" property="priority"/>
        </association>
        <association property="local" column="local_id" javaType="com.house.entity.WorkArea">
            <id column="local_id" property="workareaid"/>
            <result column="local_name" property="workareaname"/>
            <result column="lpriority" property="priority"/>
        </association>
    </resultMap>

    <update id="updateServicer" parameterType="com.house.entity.Servicer">
        update tb_servicer
        <set>
            <if test="enablestatus != null">enable_status=#{enablestatus},</if>
            <if test="createtime != null">create_time=#{createtime},</if>
            <if test="lastedittime != null">lastedit_time=#{lastedittime},</if>
        </set>
        where servicer_id=#{servicerid}
    </update>

    <select id="queryServicer" resultMap="servicermap">
        select
        s.servicer_id,
        s.servicer_name,
        s.servicer_age,
        s.servicer_sex,
        s.servicer_phone,
        s.servicer_img,
        s.servicer_experience,
        s.servicer_score,
        s.servicer_price,
        s.servicer_des,
        s.servicer_file,
        s.create_time,
        s.lastedit_time,
        s.enable_status,
        s.check_status,
        d.degree_id,
        d.degree_name,
        d.priority as dpriority,
        st.servicetype_id,
        st.servicetype_name,
        st.priority as stpriority,
        c.workarea_id as city_id,
        c.workarea_name as city_name,
        c.priority as cpriority,
        l.workarea_id as local_id,
        l.workarea_name as local_name,
        l.priority as lpriority
        from tb_servicer s,tb_degree d,tb_servicetype st,tb_workarea c,tb_workarea l
        <where>
            and s.degree_id=d.degree_id
            and s.servicetype_id=st.servicetype_id
            and s.city_id=c.workarea_id
            and s.local_id=l.workarea_id
        </where>
    </select>

    <select id="queryQualify" resultMap="servicermap">
        select
        s.servicer_id,
        s.servicer_name,
        s.servicer_age,
        s.servicer_sex,
        s.servicer_phone,
        s.servicer_img,
        s.servicer_experience,
        s.servicer_score,
        s.servicer_price,
        s.servicer_des,
        s.servicer_file,
        s.create_time,
        s.lastedit_time,
        s.enable_status,
        s.check_status,
        d.degree_id,
        d.degree_name,
        d.priority as dpriority,
        st.servicetype_id,
        st.servicetype_name,
        st.priority as stpriority,
        c.workarea_id as city_id,
        c.workarea_name as city_name,
        c.priority as cpriority,
        l.workarea_id as local_id,
        l.workarea_name as local_name,
        l.priority as lpriority
        from tb_servicer s,tb_degree d,tb_servicetype st,tb_workarea c,tb_workarea l
        <where>
            and check_status=0
            and s.degree_id=d.degree_id
            and s.servicetype_id=st.servicetype_id
            and s.city_id=c.workarea_id
            and s.local_id=l.workarea_id
        </where>
        order by lastedit_time desc
    </select>

    <select id="querySingleServicer" resultType="com.house.entity.Servicer">
--         select servicer_id,servicer_name,servicer_age,servicer_sex,servicer_phone,servicer_img,servicer_experience,servicer_score,servicer_price,servicer_des,servicer_file,degree_id,create_time,lastedit_time,enable_status
        select servicer_id,servicer_name,servicer_age,servicer_sex,servicer_phone,enable_status
        from tb_servicer
        <where>
            <if test="servicerid != null">
                and servicer_id=#{servicerid}
            </if>
            <if test="enablestatus != null">
                and enable_status=#{enablestatus}
            </if>
        </where>
    </select>
</mapper>